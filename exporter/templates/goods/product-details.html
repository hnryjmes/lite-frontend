{% extends 'layouts/base.html' %}

{% load date firearm_details_summary %}

{% block back_link %}
	<div class="govuk-breadcrumbs">
		<ol class="govuk-breadcrumbs__list">
			<li class="govuk-breadcrumbs__list-item">
				<a class="govuk-breadcrumbs__link" href="{% url 'core:home' %}">
					{% lcs 'hub.ACCOUNT_HOME' %}
				</a>
			</li>
			<li class="govuk-breadcrumbs__list-item">
				<a class="govuk-breadcrumbs__link" href="{% url 'goods:goods' %}">
					{% lcs 'goods.GoodsList.TITLE' %}
				</a>
			</li>
			<li class="govuk-breadcrumbs__list-item">
				{% lcs 'goods.GoodPage.TITLE' %}
			</li>
		</ol>
	</div>
{% endblock %}

{% block body %}
    <div class="lite-app-bar">
        <div class="lite-app-bar__content">
            <h1 class="govuk-heading-xl">
                {% block title %}
                    {{ good.name }}
                {% endblock %}
            </h1>
        </div>
    </div>

    {% with firearm_details=good.firearm_details %}
        <dl class="govuk-summary-list govuk-!-margin-bottom-9" id="good-detail-summary">
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                    Select the type of firearm product
                </dt>
                <dd class="govuk-summary-list__value">
                    {{ good.firearm_details.type.value|default_na }}
                </dd>
                <dd class="govuk-summary-list__actions">
                </dd>
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                    Firearm category
                </dt>
                <dd class="govuk-summary-list__value">
                    {% for category in firearm_details.category %}
                        {{ category.value }}{% if not forloop.last %}, {% endif %}
                    {% empty %}
                        N/A
                    {% endfor %}
                </dd>
                <dd class="govuk-summary-list__actions">
                </dd>
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                    Give the product a descriptive name
                </dt>
                <dd class="govuk-summary-list__value">
                    {{ good.name }}
                </dd>
                <dd class="govuk-summary-list__actions">
                </dd>
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                    Do you know the product's control list entry?
                </dt>
                <dd class="govuk-summary-list__value">
                    {{ good.is_good_controlled.value }}
                </dd>
                <dd class="govuk-summary-list__actions">
                </dd>
            </div>
            {% if good.is_good_controlled.key == "True" %}
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        Enter the control list entry
                    </dt>
                    <dd class="govuk-summary-list__value">
                        {% for clc in good.control_list_entries %}
                            {{ clc.rating }}{% if not forloop.last %}, {% endif %}
                        {% endfor %}
                    </dd>
                    <dd class="govuk-summary-list__actions">
                    </dd>
                </div>
            {% endif %}
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                    Does the product have a government security grading or classification?
                </dt>
                <dd class="govuk-summary-list__value">
                    {{ good.is_pv_graded.value }}
                </dd>
                <dd class="govuk-summary-list__actions">
                </dd>
            </div>
            {% if good.is_pv_graded.key == "yes" %}
                {% if good.pv_grading_details.prefix %}
                    <div class="govuk-summary-list__row">
                        <dt class="govuk-summary-list__key">
                            Enter a prefix (optional)
                        </dt>
                        <dd class="govuk-summary-list__value">
                            {{ good.pv_grading_details.prefix }}
                        </dd>
                        <dd class="govuk-summary-list__actions">
                        </dd>
                    </div>
                {% endif %}
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        What is the security grading or classification?
                    </dt>
                    <dd class="govuk-summary-list__value">
                        {{ good.pv_grading_details.grading.value }}
                    </dd>
                    <dd class="govuk-summary-list__actions">
                    </dd>
                </div>
                {% if good.pv_grading_details.suffix %}
                    <div class="govuk-summary-list__row">
                        <dt class="govuk-summary-list__key">
                            Enter a suffix (optional)
                        </dt>
                        <dd class="govuk-summary-list__value">
                            {{ good.pv_grading_details.suffix }}
                        </dd>
                        <dd class="govuk-summary-list__actions">
                        </dd>
                    </div>
                {% endif %}
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        Name and address of the issuing authority
                    </dt>
                    <dd class="govuk-summary-list__value">
                        {{ good.pv_grading_details.issuing_authority|linebreaksbr }}
                    </dd>
                    <dd class="govuk-summary-list__actions">
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        Reference
                    </dt>
                    <dd class="govuk-summary-list__value">
                        {{ good.pv_grading_details.reference }}
                    </dd>
                    <dd class="govuk-summary-list__actions">
                    </dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        Date of issue
                    </dt>
                    <dd class="govuk-summary-list__value">
                        {{ good.pv_grading_details.date_of_issue|to_date|date:"j F Y" }}
                    </dd>
                    <dd class="govuk-summary-list__actions">
                    </dd>
                </div>
            {% endif %}
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                    What is the calibre of the product?
                </dt>
                <dd class="govuk-summary-list__value">
                    {{ firearm_details.calibre }}
                </dd>
                <dd class="govuk-summary-list__actions">
                </dd>
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                    Is the product a replica firearm?
                </dt>
                <dd class="govuk-summary-list__value">
                    {{ firearm_details.is_replica|yesno|title }}
                    {% if firearm_details.is_replica %}
                        <div class="govuk-hint">
                            {{ firearm_details.replica_description }}
                        </div>
                    {% endif %}
                </dd>
                <dd class="govuk-summary-list__actions">
                </dd>
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                    Are you a registered firearms dealer?
                </dt>
                <dd class="govuk-summary-list__value">
                    {{ is_user_rfd|yesno|title }}
                </dd>
                <dd class="govuk-summary-list__actions">
                </dd>
            </div>
            {% if firearm_details.is_covered_by_firearm_act_section_one_two_or_five == "Yes" %}
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        Which section of the Firearms Act 1968 is the product covered by?
                    </dt>
                    <dd class="govuk-summary-list__value">
                        {% if firearm_details.firearms_act_section == "Unsure" %}
                            Don't know
                        {%  else  %}
                            {{ firearm_details.firearms_act_section|firearm_act_section_label }}
                        {%  endif %}
                    </dd>
                    <dd class="govuk-summary-list__actions">
                    </dd>
                </div>
                {% if firearm_details.firearms_act_section == "firearms_act_section5" %}
                    <div class="govuk-summary-list__row">
                        <dt class="govuk-summary-list__key">
                            Upload your section 5 letter of authority
                        </dt>
                        <dd class="govuk-summary-list__value">
                            {% if firearm_details.section_certificate_missing %}
                                I do not have a section 5 letter of authority
                                <div class="govuk-hint">
                                    {{ firearm_details.section_certificate_missing_reason }}
                                </div>
                            {% else %}
                                {% with document=organisation_documents.section_five_certificate %}
                                    {% if document.document.safe %}
                                        <a class="govuk-link govuk-link--no-visited-state" href="{% url 'organisation:document' pk=document.id %}" target="_blank">{{ document.document.name }}</a>
                                    {% else %}
                                        {{ document.document.name }}
                                    {% endif %}
                                {% endwith %}
                            {% endif %}
                        </dd>
                        <dd class="govuk-summary-list__actions">
                        </dd>
                    </div>
                    {% if not firearm_details.section_certificate_missing %}
                        <div class="govuk-summary-list__row">
                            <dt class="govuk-summary-list__key">
                                Certificate reference number
                            </dt>
                            <dd class="govuk-summary-list__value">
                                {{ firearm_details.section_certificate_number }}
                            </dd>
                            <dd class="govuk-summary-list__actions">
                            </dd>
                        </div>
                        <div class="govuk-summary-list__row">
                            <dt class="govuk-summary-list__key">
                                Certificate date of expiry
                            </dt>
                            <dd class="govuk-summary-list__value">
                                {{ firearm_details.section_certificate_date_of_expiry|to_date|date:"j F Y" }}
                            </dd>
                            <dd class="govuk-summary-list__actions">
                            </dd>
                        </div>
                    {% endif %}
                {% endif %}
            {% elif firearm_details.is_covered_by_firearm_act_section_one_two_or_five %}
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        Which section of the Firearms Act 1968 is the product covered by?
                    </dt>
                    <dd class="govuk-summary-list__value">
                        {% if firearm_details.is_covered_by_firearm_act_section_one_two_or_five == "Unsure" %}
                            Don't know
                        {%  else  %}
                            {{ firearm_details.is_covered_by_firearm_act_section_one_two_or_five }}
                        {%  endif %}
                        {% if firearm_details.is_covered_by_firearm_act_section_one_two_or_five_explanation %}
                            <div class="govuk-hint">
                                {{ firearm_details.is_covered_by_firearm_act_section_one_two_or_five_explanation }}
                            </div>
                        {% endif %}
                    </dd>
                    <dd class="govuk-summary-list__actions">
                    </dd>
                </div>
            {% endif %}
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">
                    Do you have a document that shows what your product is and what it’s designed to do?
                </dt>
                <dd class="govuk-summary-list__value">
                    {{ good.is_document_available|yesno|title }}
                </dd>
                <dd class="govuk-summary-list__actions">
                </dd>
            </div>
            {% if good.is_document_available %}
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        Is the document rated above Official-sensitive?
                    </dt>
                    <dd class="govuk-summary-list__value">
                        {{ good.is_document_sensitive|yesno|title }}
                    </dd>
                    <dd class="govuk-summary-list__actions">
                    </dd>
                </div>
                {% if not good.is_document_sensitive %}
                    <div class="govuk-summary-list__row">
                        <dt class="govuk-summary-list__key">
                            Upload a document that shows what your product is designed to do
                        </dt>
                        <dd class="govuk-summary-list__value">
                            {% for document in good.documents %}
                                {% if document.safe %}
                                    <a href="{% url 'goods:document' pk=good.id file_pk=document.id %}" class="govuk-link govuk-link--no-visited-state" target="_blank">
                                        {{ document.name }}
                                    </a>
                                {% else %}
                                    {{ document.name }}
                                {% endif %}
                            {% endfor %}
                        </dd>
                        <dd class="govuk-summary-list__actions">
                        </dd>
                    </div>
                    <div class="govuk-summary-list__row">
                        <dt class="govuk-summary-list__key">
                            Description (optional)
                        </dt>
                        <dd class="govuk-summary-list__value">
                            {% for document in good.documents %}
                                {{ document.description }}
                            {% endfor %}
                        </dd>
                        <dd class="govuk-summary-list__actions">
                        </dd>
                    </div>
                {% endif %}
            {% else %}
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                        Explain why you are not able to upload a product document
                    </dt>
                    <dd class="govuk-summary-list__value">
                        {{ good.no_document_comments }}
                    </dd>
                    <dd class="govuk-summary-list__actions">
                    </dd>
                </div>
            {% endif %}
        </dl>
    {% endwith %}
{% endblock %}
